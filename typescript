export const updateSubscription = mutation({
  args: {
    id: v.id("subscriptions"),
    name: v.string(),
    ownerEmail: v.email(),
    ownerName: v.string().optional(),
    plan: v.any(),
    durationMonths: v.number(),
    endDate: v.number(),
  },
  async handler({ id, name, ownerEmail, ownerName, plan, durationMonths, endDate }) {
    const subscriptionEndsAt = Date.now() + (args.durationMonths * 30 * 24 * 60 * 60 * 1000);
    
    const updates: any = {
        planId: args.planId,
        // endDate: args.endDate, // This would overwrite with undefined if not passed?
        status: args.status,
    };
    if (args.endDate !== undefined) {
        updates.endDate = args.endDate;
    }
    
    await updateSubscription({
      id,
      name,
      ownerEmail,
      ownerName: ownerName || undefined,
      plan: plan as any,
      durationMonths: parseInt(durationMonths),
      endDate: endDate,
    });
  },
});